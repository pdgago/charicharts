!function(){"use strict";function a(a,b){return"translate("+[a,b]+")"}function b(a,b){var c,d;if(0!==a&&0!==b){if(d=Math.atan(b/a),d+=0>d?Math.PI/2:0,a>=0&&b>=0)c=d;else if(0>=a&&b>=0)c=d+Math.PI/2;else if(0>=a&&0>=b)c=d+Math.PI;else{if(!(a>=0&&0>=b))return;c=d+3*(Math.PI/2)}return c}}function c(){return this.init.apply(this,arguments),{on:this.$scope.on,unbind:this.$scope.unbind}}function d(a){var b=this;this.$scope={},this.$scope.opts=this._opts,this.$scope.data=this._data;var c=h(this.$scope);_.each(a,function(a){var d=c(a);_.extend(b.$scope,d)})}function e(){return this.init.apply(this,arguments),_.omit(this,"$scope","call","parseOpts","render","setInnerArrow")}function f(){return this.init.apply(this,arguments),_.omit(this,"$scope","call","parseOpts","render")}var g={version:"0.0.0"};String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})});var h=function(a){return function(b){var c=b[b.length-1];return b=b.slice(0,b.length-1).map(function(b){return a[b]}),c.apply(a,b)}},i=["svg","xscale","yscale","opts",function(b,c,d,e){function f(f){var h={bottom:{axis:"xaxis",translate:a(0,e.height),textAnchor:"middle"},top:{axis:"xaxis",translate:a(0,0),textAnchor:"middle"},left:{axis:"yaxis",translate:a(0,0),textAnchor:"start"},right:{axis:"yaxis",translate:a(e.width+e.margin.right,0),textAnchor:"end"}},i=h[f],j=d3.svg.axis().scale("xaxis"===i.axis?c:d).orient(f).tickFormat(e[i.axis][f].tickFormat);e[i.axis].ticks&&j.ticks.apply(this,e[i.axis].ticks);var k=b.append("g").attr("class",i.axis+" "+f).attr("transform",i.translate).call(j),l=k.selectAll("text");l.style("text-anchor",i.textAnchor),"yaxis"===i.axis&&(l.attr("x","left"===f?-e.margin.left:0).attr("y",e.yaxis.textMarginTop),b.select(".yaxis .domain").remove()),e[i.axis][f].label&&g(k,e[i.axis][f].label,f)}function g(a,b,c){if("top"!==c){var d={bottom:{x:0-e.margin.left,y:e.margin.bottom-7,textAnchor:"start"},left:{x:-e.margin.left,y:e.yaxis.textMarginTop-20,textAnchor:"start"},right:{x:0,y:e.yaxis.textMarginTop-20,textAnchor:"end"}},f=d[c];a.append("text").attr("class","label").attr("x",f.x).attr("y",f.y).attr("text-anchor",f.textAnchor).text(b)}}function h(){b.selectAll(".xaxis .domain").attr("d","M{0},0V0H{1}V0".format(-e.margin.left,e.fullWidth))}function i(){b.select(".yaxis").selectAll("line").attr("x1",e.yaxis.fullGrid?-e.margin.left:0).attr("x2",e.yaxis.fullGrid?e.width+e.margin.right:e.width).each(function(a){0===a&&d3.select(this).attr("class","zeroline")})}e.yaxis.left.enabled&&f("left"),e.yaxis.right.enabled&&f("right"),e.xaxis.top.enabled&&f("top"),e.xaxis.bottom.enabled&&f("bottom"),(e.yaxis.left.enabled||e.yaxis.right.enabled)&&i(),(e.xaxis.top.enabled||e.xaxis.bottom.enabled)&&h()}],j=[function(){var a={},b=a.c_||{};return a.trigger=function(c,d){for(var e=b[c],f=e?e.length:0;f--;)e[f].apply(a,d||[])},a.on=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unbind=function(a,c){var d=b[c?a:a[0]],e=d?d.length:0;for(c=c||a[1];e--;)d[e]===c&&d.splice(e,1)},a}],k=["data","opts",function(a,b){function c(){return d3.extent(j,function(a){return a.datetime})}function d(){var a=d3.extent(j,function(a){return a.scrutinized?d3.sum(_.pluck(a.scrutinized,"value")):Number(a.value)});if(a[0]>=0)return[0,a[1]];var b=Math.abs(a[0]),c=Math.abs(a[1]),d=b>c?b:c;return[-d,d]}function e(){return d3.extent(j,function(a){return a.scrutinized?d3.sum(_.pluck(a.scrutinized,"value")):a.value})}function f(a,b){return"time"===a?c():b?e():d()}function g(){var a=f(b.xaxis.scale,b.xaxis.fit);return i[b.xaxis.scale]().domain(a).range([0,b.width])}function h(){var a=f(b.yaxis.scale,b.yaxis.fit);return i[b.yaxis.scale]().domain(a).range([b.height,0]).nice()}var i={time:d3.time.scale.utc,ordinal:d3.scale.ordinal,linear:d3.scale.linear},j=_.flatten(_.map(a,function(a){return a.values})),k=g(),l=h();return{xscale:k,yscale:l}}],l=["data","svg","xscale","yscale","opts",function(a,b,c,d,e){function f(a){var e=d3.svg.line().x(function(a){return c(a.datetime)}).y(function(a){return d(a.value)});b.append("path").attr("id","serie"+a.id).attr("active",1).attr("class","line").attr("transform","translate(0, 0)").attr("stroke",a.color).attr("d",e.interpolate(a.interpolation)(a.values))}function g(a){b.append("g").attr("id","serie"+a.id).attr("active",1).attr("class","bar").selectAll("rect").data(a.values).enter().append("rect").attr("class",function(a){return a.value<0?"bar-negative":"bar-positive"}).attr("x",function(a){return c(a.datetime)-e.series.barWidth/2}).attr("y",function(a){return a.value<0?d(0):d(a.value)-1}).attr("width",e.series.barWidth).attr("height",function(a){return Math.abs(d(a.value)-d(0))}).attr("fill",function(){return a.color})}function h(){}_.each(a,function(a){"line"===a.type?f(a):"bar"===a.type?g(a):"stacked-bar"===a.type&&h(a)})}],m=["opts",function(a){function b(){return d3.select(a.target).append("svg").attr("width",a.responsive?"100%":a.fullWidth).attr("height",a.fullHeight).append("g").attr("class","g-main").attr("transform",a.gmainTranslate)}var c=b();return{svg:c}}];g.Chart=c,c.modules=[j,m,k,i,l],c.prototype.init=function(a,b){this._opts=this.parseOpts(a),this._data=b,d.apply(this,[c.modules])},c.defaults={margin:"0,0,0,0",trail:!1,series:{barWidth:12,stackedBarAlign:"right"},xaxis:{scale:"time",fit:!1,ticks:!1,top:{enabled:!1,label:!1,tickFormat:function(a){return a}},bottom:{enabled:!0,label:!1,tickFormat:function(a){return a.getMonth()}}},yaxis:{scale:"linear",fit:!1,fullGrid:!0,textMarginTop:0,ticks:!1,left:{enabled:!0,label:!1,tickFormat:function(a){return a}},right:{enabled:!1,label:!1,tickFormat:function(a){return a}}}},c.prototype.parseOpts=function(b){var d=_.extend({},c.defaults,b);return d.series=_.extend({},c.defaults.series,d.series),d.xaxis=_.extend({},c.defaults.xaxis,d.xaxis),d.xaxis.bottom=_.extend({},c.defaults.xaxis.bottom,d.xaxis.bottom),d.xaxis.top=_.extend({},c.defaults.xaxis.top,d.xaxis.top),d.yaxis=_.extend({},c.defaults.yaxis,d.yaxis),d.yaxis.left=_.extend({},c.defaults.yaxis.left,d.yaxis.left),d.yaxis.right=_.extend({},c.defaults.yaxis.right,d.yaxis.right),d.margin=_.object(["top","right","bottom","left"],d.margin.split(",").map(Number)),(d.yaxis.left.label||d.yaxis.right.label)&&(d.margin.top+=Math.abs(d.yaxis.textMarginTop-30)),d.fullWidth=d.target.offsetWidth,d.fullHeight=d.target.offsetHeight,d.width=d.fullWidth-d.margin.left-d.margin.right,d.height=d.fullHeight-d.margin.top-d.margin.bottom,d.gmainTranslate=a(d.margin.left,d.margin.top),d},g.Pie=e,e.prototype.init=function(a){this._opts=this.parseOpts(a),_.extend(this,g.Events(this)),this.$scope=_.extend({},this._opts),this.$scope.trigger=this.trigger,this.call=h(this.$scope),this.render()},e.defaults={margin:"0,0,0,0",innerRadius:.5,outerBorder:.1,fadeOpacity:1,innerArrow:!1,innerArrowSize:.6},e.prototype.setInnerArrow=function(){function a(a){var d=c.$scope.arc.centroid(a),f=b(d[0],d[1]),g=Math.cos(f),h=Math.sin(f),i=e*g,j=e*h;i&&j&&c.$scope.innerArrow.attr("x2",i).attr("y2",j)}var c=this,d=this._opts,e=this.$scope.radius*(1-d.outerBorder),f=e*d.innerArrowSize*(1-d.innerRadius),g=e*d.innerRadius*2;f>g&&(f=.5*g),this.$scope.svg.append("svg:marker").attr("id","innerArrow").attr("viewBox","0 {0} {1} {2}".format(-(f/2),f,f)).attr("refX",e*(1-d.innerRadius)+5).attr("refY",0).attr("fill","white").attr("markerWidth",f).attr("markerHeight",f).attr("orient","auto").append("svg:path").attr("d","M0,{0}L{1},0L0,{2}".format(-(f/2),f,f/2)),this.$scope.innerArrow=this.$scope.svg.append("line").attr("class","outer-border").style("stroke","transparent").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0).attr("marker-end","url(#innerArrow)"),this.on("mouseover",function(b){a(b)}),this.moveArrowTo=function(a){c.$scope.pieces.each(function(b){b.data.id===a&&c.$scope.trigger("mouseover",[b])})},setTimeout(function(){var a=c.$scope.pieces.data()[0];c.$scope.trigger("mouseover",[a])},0)},e.prototype.parseOpts=function(b){var c=_.extend({},e.defaults,b);return c.margin=_.object(["top","right","bottom","left"],c.margin.split(",").map(Number)),c.fullWidth=c.target.offsetWidth,c.fullHeight=c.target.offsetHeight,c.width=c.fullWidth-c.margin.left-c.margin.right,c.height=c.fullHeight-c.margin.top-c.margin.bottom,c.gmainTranslate=a(c.fullWidth/2,c.fullHeight/2),c},e.prototype.render=function(){var a=this;this.$scope.radius=Math.min(this._opts.fullWidth,this._opts.fullHeight)/2,this.$scope.svg=this.call(m).draw(),this._opts.outerBorder&&this.$scope.svg.append("svg:circle").attr("class","outer-border").attr("fill","transparent").attr("cx",0).attr("cy",0).attr("r",this.$scope.radius),this.$scope.pieLayout=d3.layout.pie().sort(null).value(function(a){return a.value});var b=this._opts.outerBorder?1-this._opts.outerBorder:1,c=this.$scope.radius*b;this.$scope.arc=d3.svg.arc().innerRadius(c-c*(1-this._opts.innerRadius)).outerRadius(c),this.$scope.pieces=this.$scope.svg.selectAll("path").data(this.$scope.pieLayout(this._opts.data)).enter().append("path").attr("class","pie-piece").attr("fill",_.bind(function(a){return a.data.color},this)).attr("d",this.$scope.arc),this.$scope.pieces.on("mouseover",function(b){a.$scope.pieces.style("opacity",a._opts.fadeOpacity),d3.select(this).style("opacity",1),a.$scope.trigger("mouseover",[b])}),this.$scope.svg.on("mouseleave",function(){a.$scope.pieces.style("opacity",1)}),this._opts.innerArrow&&this.setInnerArrow()},g.Bar=f,f.prototype.init=function(a){this._opts=this.parseOpts(a),_.extend(this,g.Events(this)),this.$scope=_.extend({},this._opts),this.$scope.trigger=this.trigger,this.call=h(this.$scope),this.render(this._opts.type)},f.defaults={margin:"0,0,0,0",type:"percentage"},f.prototype.parseOpts=function(b){var c=_.extend({},f.defaults,b);return c.margin=_.object(["top","right","bottom","left"],c.margin.split(",").map(Number)),c.fullWidth=c.target.offsetWidth,c.fullHeight=c.target.offsetHeight,c.width=c.fullWidth-c.margin.left-c.margin.right,c.height=c.fullHeight-c.margin.top-c.margin.bottom,c.gmainTranslate=a(0,0),c.responsive=!0,c},f.prototype.render=function(a){function b(){d.$scope.svg=d.call(m).draw();var a=d3.sum(_.pluck(d._opts.data,"value")),b=0,c=_.map(d._opts.data,function(c){var d={x0:b,x1:100*c.value/a,color:c.color};return b+=d.x1,d});d.$scope.svg.selectAll("rect").data(c).enter().append("rect").attr("x",function(a){return a.x0+"%"}).attr("y",0).attr("width",function(a){return a.x1+"%"}).attr("height",d._opts.height).style("fill",function(a){return a.color})}function c(){}var d=this,e={percentage:b,stacked:c},f=e[a];f()},"function"==typeof define&&define.amd?define(g):"object"==typeof module&&module.exports&&(module.exports=g),this.Charicharts=g}.call(window);