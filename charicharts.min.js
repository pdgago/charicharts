!function(){"use strict";function a(a,b){return"translate("+a+","+b+")"}function b(a){return a.margin=_.object(["top","right","bottom","left"],a.margin.split(",").map(Number)),a.fullWidth=a.target.offsetWidth,a.fullHeight=a.target.offsetHeight,a.width=a.fullWidth-a.margin.left-a.margin.right,a.height=a.fullHeight-a.margin.top-a.margin.bottom,a}function c(a,b){return d3.svg.axis().scale(a).orient(b.orient).tickFormat(b.tickFormat)}function d(a,b){return d3.svg.axis().scale(a).orient(b.orient).tickSize(-b.width).tickFormat(b.tickFormat)}function e(a){function b(){return d3.extent(i,function(a){return a.datetime})}function c(){return[0,d3.max(i,function(a){return a.value})]}function d(){return d3.extent(i,function(a){return a.value})}function e(a,e){return"time"===a?b():e?d():c()}function f(){var b=e(a.xaxis.scale,a.xaxis.fit);return h[a.xaxis.scale]().domain(b).range([0,a.width])}function g(){var b=e(a.yaxis.scale,a.yaxis.fit);return h[a.yaxis.scale]().domain(b).range([a.height,0])}var h={time:d3.time.scale,ordinal:d3.scale.ordinal,linear:d3.scale.linear},i=_.flatten(_.map(a.data,function(a){return a.values}));return[f(),g()]}var f={version:"0.0.0"},g="g-main";f.chart=function(a){return this._options=b(_.extend({},this.constructor.defaults,a)),_.extend(this,f.Events(this)),this.init(),this},f.chart.prototype.init=function(){var b=this._options,f=h(this),l=d3.select(b.target).append("svg").attr("width",b.fullWidth).attr("height",b.fullHeight).append("g").attr("class",g).attr("transform",a(b.margin.left,b.margin.top));this.svg=l;var m=e(_.pick(b,"width","height","xaxis","yaxis","data")),n=m[0],o=m[1];this.scales=m,this.xscale=n,this.yscale=o,this.width=this._options.width,this.height=this._options.height;var p,q;b.xaxis.display&&(p=c(n,_.pick(b.xaxis,"orient","tickFormat"))),b.yaxis.display&&(q=d(o,_.extend(_.pick(b.yaxis,"orient","tickFormat"),{width:b.width}))),p&&l.append("g").attr("class","xaxis").attr("transform",a(0,b.height)).call(p).selectAll("text").style("text-anchor","middle"),q&&l.append("g").attr("class","yaxis").attr("transform",a(0,0)).call(q).selectAll("text").attr("x",0).style("text-anchor","start"),_.each(b.data,function(a){"line"===a.type?f(j).drawLine(a):"bar"===a.type&&f(i).drawBar(a)}),b.trail&&f(k),l.selectAll(".domain").remove()},f.chart.defaults={margin:"0,0,0,0",trail:!1,xaxis:{scale:"time",fit:!1,orient:"bottom",display:!0,tickFormat:function(a){return a instanceof Date?a.getHours():a}},yaxis:{scale:"linear",fit:!1,display:!0,orient:"left",tickFormat:function(a){return a}}},f.Events=function(a){var b=a.c_||{},c=function(c,d){for(var e=b[c],f=e?e.length:0;f--;)e[f].apply(a,d||[])},d=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},e=function(a,c){var d=b[c?a:a[0]],e=d?d.length:0;for(c=c||a[1];e--;)d[e]===c&&d.splice(e,1)};return{trigger:c,on:d,unbind:e}};var h=function(a){return function(b){var c=b[b.length-1];return b=b.slice(0,b.length-1).map(function(b){return a[b]}),c.apply(a,b)}};f.pie=function(a){return this._options=b(_.extend(a,this.constructor.defaults)),_.extend(this,f.Events(this)),this.init(),this},f.pie.prototype.init=function(){var b=this._options,c=Math.min(b.fullWidth,b.fullHeight)/2,d=d3.select(b.target).append("svg").attr("width",b.fullWidth).attr("height",b.fullHeight).append("g").attr("class",g).attr("transform",a(b.fullWidth/2,b.fullHeight/2));d.append("svg:circle").attr("class","outer-circle").attr("fill","transparent").attr("cx",0).attr("cy",0).attr("r",c);var e=d3.layout.pie().value(function(a){return a.value||100/b.data.length}),f=d3.svg.arc().innerRadius(.9*c-b.fullWidth*b.innerRadius).outerRadius(.9*c);d.selectAll("path").data(e(b.data)).enter().append("path").attr("fill",_.bind(function(a){return a.data.color},this)).attr("d",f)},f.pie.defaults={innerRadius:.22,margin:"0,0,0,0"};var i=["scales","svg","height",function(a,b,c){function d(d){b.append("g").attr("class","bar").selectAll("rect").data(d.values).enter().append("rect").attr("x",function(b){return a[0](b.datetime)}).attr("y",function(b){return a[1](b.value)}).attr("width",10).attr("fill",function(){return d.color}).attr("height",function(b){return c-a[1](b.value)})}return{drawBar:d}}],j=["scales","svg",function(a,b){function c(a){b.append("path").attr("id",a.id).attr("class","line").attr("transform","translate(0, 0)").attr("stroke",a.color).attr("d",d.interpolate(a.interpolation)(a.values))}var d=d3.svg.line().x(function(b){return a[0](b.datetime)}).y(function(b){return a[1](b.value)});return{drawLine:c}}],k=["svg","trigger","height","width","xscale",function(b,c,d,e,f){function g(){var a,b=f.domain();if(a=d3.event.sourceEvent?f.invert(d3.mouse(this)[0]):l.extent()[0],Date.parse(a)>Date.parse(b[1])&&(a=b[1]),Date.parse(a)<Date.parse(b[0])&&(a=b[0]),a.getMinutes()>=-30&&a.setHours(a.getHours()),a.setMinutes(0,0),Date.parse(i)!==Date.parse(a)){i=a;var d=Math.round(f(a))-1;h(d),c("moveTrail",[a])}}function h(a){k.attr("x1",a).attr("x2",a)}var i,j=b.append("g").attr("class","trail"),k=j.append("svg:line").attr("class","trail-line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",d),l=d3.svg.brush().x(f).extent([0,0]),m=b.append("g").attr("transform",a(0,0)).attr("class","trail-slider").call(l);m.select(".background").attr("height",d).attr("width",e).style("cursor","pointer"),b.selectAll(".extent,.resize").remove(),l.on("brush",g)}];"function"==typeof define&&define.amd?define(f):"object"==typeof module&&module.exports&&(module.exports=f),this.Charicharts=f}.call(window);