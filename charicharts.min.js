!function(){function a(a,b){return"translate("+[a,b]+")"}function b(a,b){var c,d;if(0!==a&&0!==b){if(d=Math.atan(b/a),d+=0>d?Math.PI/2:0,a>=0&&b>=0)c=d;else if(0>=a&&b>=0)c=d+Math.PI/2;else if(0>=a&&0>=b)c=d+Math.PI;else{if(!(a>=0&&0>=b))return;c=d+3*(Math.PI/2)}return c}}function c(){this.init.apply(this,arguments);var a={};return this._opts.innerArrow&&(a.moveArrowTo=this.$scope.moveArrowTo),a}var d={version:"0.0.0"};String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){return!a&&this.init?this.init.apply(this,arguments):void 0}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}.call(window);var e=Class.extend({init:function(a,b){return this.$scope={opts:this.parseOptions(a),data:b},_.extend(this.$scope,f()),this._loadModules(this._modules),this.getInstanceProperties()},_loadModules:function(){for(var a=(this._generateInjector(this.$scope),0);a<this.modules.length;a++)_.extend(this.$scope,new this.modules[a](this.$scope))},_generateInjector:function(a){return function(b){var c=b[b.length-1];return b=b.slice(0,b.length-1).map(function(b){return a[b]}),c.apply(a,b)}}}),f=function(){var a={},b=a.c_||{};return a.trigger=function(c,d){for(var e=b[c],f=e?e.length:0;f--;)e[f].apply(a,d||[])},a.on=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unbind=function(a,c){var d=b[c?a:a[0]],e=d?d.length:0;for(c=c||a[1];e--;)d[e]===c&&d.splice(e,1)},a},g=Class.extend({_coreSubscriptions:[{"Scope/emit":function(a){_.extend(this,a)}}],init:function(a){return this._loadModules(a),this.status=new h,_.each(_.union(this._coreSubscriptions,this._subscriptions),this._subscribe,this),this.initialize()},_loadModules:function(a){for(var b=this.deps.length-1;b>=0;b--)this[this.deps[b]]=a[this.deps[b]];this.on=a.on,this.trigger=a.trigger},_subscribe:function(a){_.each(a,_.bind(function(a,b){this.on(b,_.bind(a,this))},this))},emit:function(a){this.trigger("Scope/emit",[a])}}),h=Class.extend({init:function(){return this.attributes={},this},get:function(a){return this.attributes[a]},set:function(a){_.extend(this.attributes,a)},toJSON:function(){return _.clone(this.attributes)}}),i=g.extend({deps:["svg","opts","xscale","yscale"],_subscriptions:[{"Scale/update":function(){}}],initialize:function(){this.opts.yaxis.left.enabled&&this._setAxis("left"),this.opts.yaxis.right.enabled&&this._setAxis("right"),this.opts.xaxis.top.enabled&&this._setAxis("top"),this.opts.xaxis.bottom.enabled&&this._setAxis("bottom"),(this.opts.yaxis.left.enabled||this.opts.yaxis.right.enabled)&&this._setYGrid(),(this.opts.xaxis.top.enabled||this.opts.xaxis.bottom.enabled)&&this._setXDomainFullwidth()},_setAxis:function(b){var c={bottom:{axis:"xaxis",translate:a(0,this.opts.height),textAnchor:"middle"},top:{axis:"xaxis",translate:a(0,0),textAnchor:"middle"},left:{axis:"yaxis",translate:a(0,0),textAnchor:"start"},right:{axis:"yaxis",translate:a(this.opts.width+this.opts.margin.right,0),textAnchor:"end"}},d=c[b],e=d3.svg.axis().scale("xaxis"===d.axis?this.xscale:this.yscale).orient(b).tickFormat(this.opts[d.axis][b].tickFormat);this.opts[d.axis].ticks&&e.ticks.apply(this,this.opts[d.axis].ticks);var f=this.svg.append("g").attr("class",d.axis+" "+b).attr("transform",d.translate).call(e),g=f.selectAll("text");g.style("text-anchor",d.textAnchor),"yaxis"===d.axis&&(g.attr("x","left"===b?-this.opts.margin.left:0).attr("y",this.opts.yaxis.textMarginTop),this.svg.select(".yaxis .domain").remove()),this.opts[d.axis][b].label&&this._setLabel(f,this.opts[d.axis][b].label,b)},_setXDomainFullwidth:function(){this.svg.selectAll(".xaxis .domain").attr("d","M{0},0V0H{1}V0".format(-this.opts.margin.left,this.opts.fullWidth))},_setYGrid:function(){this.svg.select(".yaxis").selectAll("line").attr("x1",this.opts.yaxis.fullGrid?-this.opts.margin.left:0).attr("x2",this.opts.yaxis.fullGrid?this.opts.width+this.opts.margin.right:this.opts.width).each(function(a){0===a&&d3.select(this).attr("class","zeroline")})},_setLabel:function(a,b,c){if("top"!==c){var d={bottom:{x:0-this.opts.margin.left,y:this.opts.margin.bottom-7,textAnchor:"start"},left:{x:-this.opts.margin.left,y:this.opts.yaxis.textMarginTop-20,textAnchor:"start"},right:{x:0,y:this.opts.yaxis.textMarginTop-20,textAnchor:"end"}},e=d[c];a.append("text").attr("class","label").attr("x",e.x).attr("y",e.y).attr("text-anchor",e.textAnchor).text(b)}},getScopeParams:function(){return{}}}),j=["opts","svg","on","trigger","pieArc","piePieces",function(a,c,d,e,f,g){function h(){function h(a){var c=f.centroid(a),d=b(c[0],c[1]),e=Math.cos(d),g=Math.sin(d),h=j*e,i=j*g;h&&i&&l.attr("x2",h).attr("y2",i)}var i,j=a.radius*(1-a.outerBorder),k=j*a.innerRadius*2;i=i>k?.5*k:j*a.innerArrowSize*(1-a.innerRadius),c.append("svg:marker").attr("id","innerArrow").attr("viewBox","0 {0} {1} {2}".format(-(i/2),i,i)).attr("refX",j*(1-a.innerRadius)+5).attr("refY",0).attr("fill","white").attr("markerWidth",i).attr("markerHeight",i).attr("orient","auto").append("svg:path").attr("d","M0,{0}L{1},0L0,{2}".format(-(i/2),i,i/2));var l=c.append("line").attr("class","outer-border").style("stroke","transparent").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0).attr("marker-end","url(#innerArrow)");d("mouseover",function(a){h(a)}),setTimeout(function(){var a=g.data()[0];e("mouseover",[a])},0)}function i(a){g.each(function(b){b.data.id===a&&e("mouseover",[b])})}return a.innerArrow?(h(),{moveArrowTo:i}):void 0}],k=["opts","svg","data","trigger",function(a,b,c,d){a.outerBorder&&b.append("svg:circle").attr("class","outer-border").attr("fill","transparent").attr("cx",0).attr("cy",0).attr("r",a.radius);var e=d3.layout.pie().sort(null).value(function(a){return a.value}),f=a.outerBorder?1-a.outerBorder:1,g=a.radius*f,h=d3.svg.arc().innerRadius(g-g*(1-a.innerRadius)).outerRadius(g),i=b.selectAll("path").data(e(c)).enter().append("path").attr("class","pie-piece").attr("fill",_.bind(function(a){return a.data.color},this)).attr("d",h);return i.on("mouseover",function(b){i.style("opacity",a.fadeOpacity),d3.select(this).style("opacity",1),d("mouseover",[b])}),b.on("mouseleave",function(){i.style("opacity",1)}),{pieArc:h,piePieces:i}}],l=g.extend({deps:["data","opts"],_subscriptions:[{"Serie/update":function(){this._dataFlattened=this._getFlattenedData(),this.xscale=this._getXScale(),this.yscale=this._getYScale(),this.emit({xscale:this.xscale,yscale:this.yscale}),this.trigger("Scale/update",[])}}],_d3Scales:{time:d3.time.scale.utc,ordinal:d3.scale.ordinal,linear:d3.scale.linear},initialize:function(){return this._dataFlattened=this._getFlattenedData(),this.xscale=this._getXScale(),this.yscale=this._getYScale(),{xscale:this.xscale,yscale:this.yscale}},_getFlattenedData:function(){return _.flatten(_.map(this.data,function(a){return a.values}))},_getXScale:function(){var a=this._getDomain(this.opts.xaxis.scale,this.opts.xaxis.fit);return this._d3Scales[this.opts.xaxis.scale]().domain(a).range([0,this.opts.width])},_getYScale:function(){var a=this._getDomain(this.opts.yaxis.scale,this.opts.yaxis.fit);return this._d3Scales[this.opts.yaxis.scale]().domain(a).range([this.opts.height,0]).nice()},_getDomain:function(a,b){return"time"===a?this._getTimeDomain():b?this._getLinearFitDomain():this._getLinearAllDomain()},_getTimeDomain:function(){return d3.extent(this._dataFlattened,function(a){return a.datetime})},_getLinearAllDomain:function(){var a=d3.extent(this._dataFlattened,function(a){return a.scrutinized?d3.sum(_.pluck(a.scrutinized,"value")):Number(a.value)});if(a[0]>=0)return[0,a[1]];var b=Math.abs(a[0]),c=Math.abs(a[1]),d=b>c?b:c;return[-d,d]},_getLinearFitDomain:function(){return d3.extent(this._dataFlattened,function(a){return a.scrutinized?d3.sum(_.pluck(a.scrutinized,"value")):a.value})}}),m=g.extend({deps:["data","svg","xscale","yscale","opts"],_subscriptions:[{}],initialize:function(){this.status.set({series:{}});for(var a=0;a<this.data.length;a++)this._addSerie(this.data[a]);return{updateSeries:_.bind(this.updateSeries,this)}},_addSerie:function(a){switch(a.type){case"line":this._renderLineSerie(a);break;case"bar":this._renderBarSerie(a);break;case"area":this._renderAreaSerie(a)}},updateSeries:function(){this.trigger("Serie/update",[]);var a=this.status.toJSON().series;_.each(a,_.bind(function(a){switch(a.el.attr("type")){case"line":this._updateLineSerie(a);break;case"bar":this._updateBarSerie(a);break;case"area":this._updateAreaSerie(a)}},this))},_renderLineSerie:function(a){var b=this._getLineFunc(),c=this.svg.append("path").datum(a.values).attr("type","line").attr("id","serie"+a.id).attr("class","serie-line").attr("active",1).attr("transform","translate(0, 0)").attr("stroke",a.color).attr("d",b.interpolate(a.interpolation));this.status.get("series")[a.id]={el:c,serie:a}},_updateLineSerie:function(a){var b=this._getLineFunc();a.el.attr("d",b.interpolate("linear")).attr("transform","translate(0,0)")},_getLineFunc:function(){var a=this;return d3.svg.line().x(function(b){return a.xscale(b.datetime)}).y(function(b){return a.yscale(b.value)})},_renderBarSerie:function(a){var b=this,c=this.svg.append("g").attr("type","bar").attr("id","serie"+a.id).attr("class","serie-bar").attr("active",1);c.selectAll("rect").data(a.values).enter().append("rect").attr("class",function(a){return a.value<0?"bar-negative":"bar-positive"}).attr("x",function(a){return b.xscale(a.datetime)-b.opts.series.barWidth/2}).attr("y",function(a){return a.value<0?b.yscale(0):b.yscale(a.value)-1}).attr("width",b.opts.series.barWidth).attr("height",function(a){return Math.abs(b.yscale(a.value)-b.yscale(0))}).attr("fill",a.color),this.status.get("series")[a.id]={el:c,serie:a}},_updateBarSerie:function(a){var b=this,c=a.el;a=a.serie,c.selectAll("rect").data(a.values).attr("class",function(a){return a.value<0?"bar-negative":"bar-positive"}).attr("x",function(a){return b.xscale(a.datetime)-b.opts.series.barWidth/2}).attr("y",function(a){return a.value<0?b.yscale(0):b.yscale(a.value)-1}).attr("height",function(a){return Math.abs(b.yscale(a.value)-b.yscale(0))})},_getAreaFunc:function(){var a=this;return d3.svg.area().x(function(b){return a.xscale(b.datetime)}).y0(this.yscale(0)).y1(function(b){return a.yscale(b.value)})},_renderAreaSerie:function(a){var b=this._getAreaFunc(),c=this.svg.append("path").datum(a.values).attr("type","area").attr("id","serie"+a.id).attr("class","serie-area").attr("active",1).attr("transform","translate(0, 0)").attr("fill",function(){return a.color}).attr("d",b.interpolate(a.interpolation));this.status.get("series")[a.id]={el:c,serie:a}},_updateAreaSerie:function(a){var b=this._getAreaFunc();a.el.attr("d",b.interpolate(a.serie.interpolation))},_getSerieById:function(a){return this.svg.select("#serie"+a)}}),n=g.extend({deps:["opts"],initialize:function(){return this.svg=this.drawSvg(),{svg:this.svg}},drawSvg:function(){return d3.select(this.opts.target).append("svg").attr("width",this.opts.responsive?"100%":this.opts.fullWidth).attr("height",this.opts.fullHeight).append("g").attr("class","g-main").attr("transform",this.opts.gmainTranslate)}});d.Chart=e.extend({modules:[n,l,i,m],getInstanceProperties:function(){return{update:this.$scope.updateSeries,on:this.$scope.on,unbind:this.$scope.unbind}},defaults:{margin:"0,0,0,0",trail:!1,series:{barWidth:12,stackedBarAlign:"right"},xaxis:{scale:"time",fit:!1,ticks:!1,top:{enabled:!1,label:!1,tickFormat:function(a){return a}},bottom:{enabled:!0,label:!1,tickFormat:function(a){return a.getMonth()}}},yaxis:{scale:"linear",fit:!1,fullGrid:!0,textMarginTop:0,ticks:!1,left:{enabled:!0,label:!1,tickFormat:function(a){return a}},right:{enabled:!1,label:!1,tickFormat:function(a){return a}}}},parseOptions:function(b){var c=_.extend({},this.defaults,b);return c.series=_.extend({},this.defaults.series,c.series),c.xaxis=_.extend({},this.defaults.xaxis,c.xaxis),c.xaxis.bottom=_.extend({},this.defaults.xaxis.bottom,c.xaxis.bottom),c.xaxis.top=_.extend({},this.defaults.xaxis.top,c.xaxis.top),c.yaxis=_.extend({},this.defaults.yaxis,c.yaxis),c.yaxis.left=_.extend({},this.defaults.yaxis.left,c.yaxis.left),c.yaxis.right=_.extend({},this.defaults.yaxis.right,c.yaxis.right),c.margin=_.object(["top","right","bottom","left"],c.margin.split(",").map(Number)),(c.yaxis.left.label||c.yaxis.right.label)&&(c.margin.top+=Math.abs(c.yaxis.textMarginTop-30)),c.fullWidth=c.target.offsetWidth,c.fullHeight=c.target.offsetHeight,c.width=c.fullWidth-c.margin.left-c.margin.right,c.height=c.fullHeight-c.margin.top-c.margin.bottom,c.gmainTranslate=a(c.margin.left,c.margin.top),c}}),d.Pie=c,c.prototype.init=function(a,b){this._opts=this.parseOpts(a),this._data=b,h_loadModules.apply(this,[c.modules])},c.modules=[n,k,j],c.defaults={margin:"0,0,0,0",innerRadius:.5,outerBorder:.1,fadeOpacity:1,innerArrow:!1,innerArrowSize:.6},c.prototype.parseOpts=function(b){var d=_.extend({},c.defaults,b);return d.margin=_.object(["top","right","bottom","left"],d.margin.split(",").map(Number)),d.fullWidth=d.target.offsetWidth,d.fullHeight=d.target.offsetHeight,d.width=d.fullWidth-d.margin.left-d.margin.right,d.height=d.fullHeight-d.margin.top-d.margin.bottom,d.gmainTranslate=a(d.fullWidth/2,d.fullHeight/2),d.radius=Math.min(d.fullWidth,d.fullHeight)/2,d},"function"==typeof define&&define.amd?define(d):"object"==typeof module&&module.exports&&(module.exports=d),this.Charicharts=d}.call(window);