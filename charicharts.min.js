!function(){"use strict";function a(a,b){return"translate("+[a,b]+")"}function b(a){var b=a.node(),c=b.getBBox(),d=[c.x+c.width/2,c.y+c.height/2];return d}function c(a,b){var c,d;if(0!==a&&0!==b){if(d=Math.atan(b/a),d+=0>d?Math.PI/2:0,a>=0&&b>=0)c=d;else if(0>=a&&b>=0)c=d+Math.PI/2;else if(0>=a&&0>=b)c=d+Math.PI;else{if(!(a>=0&&0>=b))return;c=d+3*(Math.PI/2)}return c}}function d(){this.init.apply(this,arguments)}function e(){this.init.apply(this,arguments)}function f(){this.init.apply(this,arguments)}var g={version:"0.0.0"};String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),g.Events=function(a){var b=a.c_||{},c=function(c,d){for(var e=b[c],f=e?e.length:0;f--;)e[f].apply(a,d||[])},d=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},e=function(a,c){var d=b[c?a:a[0]],e=d?d.length:0;for(c=c||a[1];e--;)d[e]===c&&d.splice(e,1)};return{trigger:c,on:d,unbind:e}};var h=function(a){return function(b){var c=b[b.length-1];return b=b.slice(0,b.length-1).map(function(b){return a[b]}),c.apply(a,b)}};g.Chart=d,d.prototype.init=function(a){return this._opts=this.parseOpts(a),_.extend(this,g.Events(this)),this.$scope=_.extend({},this._opts),this.$scope.trigger=this.trigger,this.call=h(this.$scope),this.render(),_.omit(this,"$scope","call","parseOpts","render")},d.prototype.addSerie=function(a){function b(){e.$scope.lines=e.call(l).drawLine(a)}function c(){e.$scope.bars=e.call(k).drawBar(a)}function d(){e.$scope.stackedBars=e.call(n).drawBar(a)}var e=this,f={line:b,bar:c,"stacked-bar":d};f[a.type]()},d.defaults={margin:"0,0,0,0",trail:!1,series:{barWidth:12,stackedBarAlign:"right"},xaxis:{scale:"time",fit:!1,ticks:!1,top:{enabled:!1,label:!1,tickFormat:function(a){return a}},bottom:{enabled:!0,label:!1,tickFormat:function(a){return a.getMonth()}}},yaxis:{scale:"linear",fit:!1,fullGrid:!0,ticksMarginTop:0,ticks:!1,left:{enabled:!0,label:!1,tickFormat:function(a){return a}},right:{enabled:!1,label:!1,tickFormat:function(a){return a}}}},d.prototype.parseOpts=function(b){var c=_.extend({},d.defaults,b);return c.series=_.extend({},d.defaults.series,c.series),c.xaxis=_.extend({},d.defaults.xaxis,c.xaxis),c.xaxis.bottom=_.extend({},d.defaults.xaxis.bottom,c.xaxis.bottom),c.xaxis.top=_.extend({},d.defaults.xaxis.top,c.xaxis.top),c.yaxis=_.extend({},d.defaults.yaxis,c.yaxis),c.yaxis.left=_.extend({},d.defaults.yaxis.left,c.yaxis.left),c.yaxis.right=_.extend({},d.defaults.yaxis.right,c.yaxis.right),c.margin=_.object(["top","right","bottom","left"],c.margin.split(",").map(Number)),(c.yaxis.left.label||c.yaxis.right.label)&&(c.margin.top+=Math.abs(c.yaxis.textMarginTop-30)),c.fullWidth=c.target.offsetWidth,c.fullHeight=c.target.offsetHeight,c.width=c.fullWidth-c.margin.left-c.margin.right,c.height=c.fullHeight-c.margin.top-c.margin.bottom,c.gmainTranslate=a(c.margin.left,c.margin.top),c},d.prototype.render=function(){var a=this;this.$scope.svg=this.call(o).draw(),this.$scope.xscale=this.call(m).getXScale(),this.$scope.yscale=this.call(m).getYScale(),this.call(j).drawY(),this.call(j).drawX(),_.each(this._opts.data,function(b){a.addSerie(b)}),this.$scope.trail&&this.call(i)},d.prototype.toggleSerie=function(a){var b=this.$scope.svg.select("#serie"+a);if(!b.empty()){var c=Number(b.attr("active"))?0:1;b.attr("active",c),b.transition().duration(200).style("opacity",b.attr("active"))}};var i=["svg","trigger","height","width","xscale","margin",function(b,c,d,e,f,g){function h(){var a,b=f.domain();if(a=d3.event.sourceEvent?f.invert(d3.mouse(this)[0]):m.extent()[0],Date.parse(a)>Date.parse(b[1])&&(a=b[1]),Date.parse(a)<Date.parse(b[0])&&(a=b[0]),a.getMinutes()>=-30&&a.setHours(a.getHours()),a.setMinutes(0,0),Date.parse(j)!==Date.parse(a)){j=a;var d=Math.round(f(a))-1;i(d),c("moveTrail",[a])}}function i(a){l.attr("x1",a).attr("x2",a)}var j,k=b.append("g").attr("class","trail"),l=(b.append("svg:marker").attr("id","trailArrow").attr("class","trail-arrow").attr("viewBox","0 0 20 20").attr("refX","15").attr("refY","11").attr("markerUnits","strokeWidth").attr("markerWidth","15").attr("markerHeight","11").attr("orient","auto").append("svg:path").attr("d","M 0 0 L 20 10 L 0 20 z").attr("fill","#777"),k.append("svg:line").attr("class","trail-line").attr("x1",0).attr("x2",0).attr("y1",-g.top+10).attr("y2",d).attr("marker-start","url(#trailArrow)")),m=d3.svg.brush().x(f).extent([0,0]),n=b.append("g").attr("transform",a(0,0)).attr("class","trail-slider").call(m);n.select(".background").attr("height",d).attr("width",e).style("cursor","pointer"),b.selectAll(".extent,.resize").remove(),m.on("brush",h),setTimeout(function(){n.call(m.extent([new Date,new Date])).call(m.event)},0)}];g.Pie=e,e.prototype.init=function(a){return this._opts=this.parseOpts(a),_.extend(this,g.Events(this)),this.$scope=_.extend({},this._opts),this.$scope.trigger=this.trigger,this.load=h(this.$scope),this.render(),_.omit("$scope","call","parseOpts","render")},e.defaults={margin:"0,0,0,0",innerRadius:.5,outerBorder:.1,fadeOpacity:1,innerArrow:!1,innerArrowSize:.6},e.prototype.setInnerArrow=function(){function a(a){var d=b.$scope.arc.centroid(a),f=c(d[0],d[1]),g=Math.cos(f),h=Math.sin(f),i=e*g,j=e*h;i&&j&&b.$scope.innerArrow.attr("x2",i).attr("y2",j)}var b=this,d=this._opts,e=this.$scope.radius*(1-d.outerBorder),f=e*d.innerArrowSize*(1-d.innerRadius),g=e*d.innerRadius*2;f>g&&(f=.5*g),this.$scope.svg.append("svg:marker").attr("id","innerArrow").attr("viewBox","0 {0} {1} {2}".format(-(f/2),f,f)).attr("refX",e*(1-d.innerRadius)+5).attr("refY",0).attr("fill","white").attr("markerWidth",f).attr("markerHeight",f).attr("orient","auto").append("svg:path").attr("d","M0,{0}L{1},0L0,{2}".format(-(f/2),f,f/2)),this.$scope.innerArrow=this.$scope.svg.append("line").attr("class","outer-border").style("stroke","transparent").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0).attr("marker-end","url(#innerArrow)"),this.$scope.pieces.on("mouseover",function(c){b.$scope.trigger("mouseover",[c]),a(c)}),this.$scope.moveArrowTo=function(c){b.$scope.pieces.each(function(d){d.data.id===c&&(b.$scope.trigger("mouseover",[d]),a(d))})},setTimeout(function(){var c=b.$scope.pieces.data()[0];a(c),b.$scope.trigger("mouseover",[c])},0)},e.prototype.parseOpts=function(b){var c=_.extend({},e.defaults,b);return c.margin=_.object(["top","right","bottom","left"],c.margin.split(",").map(Number)),c.fullWidth=c.target.offsetWidth,c.fullHeight=c.target.offsetHeight,c.width=c.fullWidth-c.margin.left-c.margin.right,c.height=c.fullHeight-c.margin.top-c.margin.bottom,c.gmainTranslate=a(c.fullWidth/2,c.fullHeight/2),c},e.prototype.render=function(){var a=this;this.$scope.radius=Math.min(this._opts.fullWidth,this._opts.fullHeight)/2,this.$scope.svg=this.load(o).draw(),this._opts.outerBorder&&this.$scope.svg.append("svg:circle").attr("class","outer-border").attr("fill","transparent").attr("cx",0).attr("cy",0).attr("r",this.$scope.radius),this.$scope.pieLayout=d3.layout.pie().sort(null).value(function(a){return a.value});var b=this._opts.outerBorder?1-this._opts.outerBorder:1,c=this.$scope.radius*b;this.$scope.arc=d3.svg.arc().innerRadius(c-c*(1-this._opts.innerRadius)).outerRadius(c),this.$scope.pieces=this.$scope.svg.selectAll("path").data(this.$scope.pieLayout(this._opts.data)).enter().append("path").attr("class","pie-piece").attr("fill",_.bind(function(a){return a.data.color},this)).attr("d",this.$scope.arc),this.$scope.pieces.on("mouseover",function(b){a.$scope.pieces.style("opacity",this._opts.fadeOpacity),d3.select(this).style("opacity",1),a.$scope.trigger("mouseover",[b])}),this.$scope.svg.on("mouseleave",function(){a.$scope.pieces.style("opacity",1)}),this._opts.innerArrow&&this.setInnerArrow()},g.Bar=f,f.prototype.init=function(a){return this._opts=this.parseOpts(a),_.extend(this,g.Events(this)),this.$scope=_.extend({},this._opts),this.$scope.trigger=this.trigger,this.call=h(this.$scope),this.render(this._opts.type),_.omit("$scope","call","parseOpts","render")},f.defaults={margin:"0,0,0,0",type:"percentage"},f.prototype.parseOpts=function(b){var c=_.extend({},f.defaults,b);return c.margin=_.object(["top","right","bottom","left"],c.margin.split(",").map(Number)),c.fullWidth=c.target.offsetWidth,c.fullHeight=c.target.offsetHeight,c.width=c.fullWidth-c.margin.left-c.margin.right,c.height=c.fullHeight-c.margin.top-c.margin.bottom,c.gmainTranslate=a(0,0),c.responsive=!0,c},f.prototype.render=function(a){function b(){d.$scope.svg=d.call(o).draw();var a=d3.sum(_.pluck(d._opts.data,"value")),b=0,c=_.map(d._opts.data,function(c){var d={x0:b,x1:100*c.value/a,color:c.color};return b+=d.x1,d});d.$scope.svg.selectAll("rect").data(c).enter().append("rect").attr("x",function(a){return a.x0+"%"}).attr("y",0).attr("width",function(a){return a.x1+"%"}).attr("height",d._opts.height).style("fill",function(a){return a.color})}function c(){}var d=this,e={percentage:b,stacked:c},f=e[a];f()};var j=["svg","xscale","yscale","xaxis","yaxis","width","height","fullWidth","margin",function(b,c,d,e,f,g,h,i,j){var k=function(d){var f="bottom"===d?e.bottom:e.top,g=d3.svg.axis().scale(c).orient(d).tickFormat(f.tickFormat);e.ticks&&g.ticks.apply(g,e.ticks),b.append("g").attr("class","xaxis "+d).attr("transform",a(0,"bottom"===d?h:0)).call(g).selectAll("text").style("text-anchor","middle"),b.select(".xaxis .domain").attr("d","M{0},0V0H{1}V0".format(-j.left,i)),f.label&&b.select(".xaxis").append("text").attr("class","label").attr("transform",a(0,0)).attr("y",j.bottom-7).attr("x",0-j.left).attr("text-anchor","start").text(f.label)},l=function(c){var e="left"===c?f.left:f.right,h=d3.svg.axis().scale(d).orient("right").tickFormat(e.tickFormat);f.ticks&&h.ticks.apply(h,f.ticks),b.append("g").attr("class","yaxis "+c).attr("transform",a("left"===c?0:g+j.right,0)).call(h).selectAll("text").attr("x","left"===c?-j.left:0).attr("y",f.textMarginTop).style("text-anchor","left"===c?f.textAnchor:"end"),b.select(".yaxis").selectAll("line").attr("x1",f.fullGrid?-j.left:0).attr("x2",f.fullGrid?g+j.right:g).each(function(a){0===a&&d3.select(this).attr("class","zeroline")}),e.label&&b.select(".yaxis").append("text").attr("class","label").attr("transform",a(0,0)).attr("y",f.textMarginTop-20).attr("x","left"===c?-j.left:g+j.right).attr("text-anchor","left"===c?"start":"end").text(e.label),b.select(".yaxis .domain").remove()};return{drawX:function(){e.bottom.enabled&&k("bottom"),e.top.enabled&&k("top")},drawY:function(){f.left.enabled&&l("left"),f.right.enabled&&l("right")}}}],k=["svg","xscale","yscale","height","series",function(a,b,c,d,e){function f(d){a.append("g").attr("id","serie"+d.id).attr("active",1).attr("class","bar").selectAll("rect").data(d.values).enter().append("rect").attr("class",function(a){return a.value<0?"bar-negative":"bar-positive"}).attr("x",function(a){return b(a.datetime)-e.barWidth/2}).attr("y",function(a){return a.value<0?c(0):c(a.value)-1}).attr("width",e.barWidth).attr("height",function(a){return Math.abs(c(a.value)-c(0))}).attr("fill",function(){return d.color})}return{drawBar:f}}],l=["svg","xscale","yscale","data",function(a,b,c){function d(b){a.append("path").attr("id","serie"+b.id).attr("active",1).attr("class","line").attr("transform","translate(0, 0)").attr("stroke",b.color).attr("d",e.interpolate(b.interpolation)(b.values))}var e=d3.svg.line().x(function(a){return b(a.datetime)}).y(function(a){return c(a.value)});return{drawLine:d}}],m=["data","xaxis","yaxis","width","height",function(a,b,c,d,e){function f(){return d3.extent(m,function(a){return a.datetime})}function g(){var a=d3.extent(m,function(a){return a.scrutinized?d3.sum(_.pluck(a.scrutinized,"value")):Number(a.value)});if(a[0]>=0)return[0,a[1]];var b=Math.abs(a[0]),c=Math.abs(a[1]),d=b>c?b:c;return[-d,d]}function h(){return d3.extent(m,function(a){return a.scrutinized?d3.sum(_.pluck(a.scrutinized,"value")):a.value})}function i(a,b){return"time"===a?f():b?h():g()}function j(){var a=i(b.scale,b.fit);return l[b.scale]().domain(a).range([0,d])}function k(){var a=i(c.scale,c.fit);return l[c.scale]().domain(a).range([e,0]).nice()}var l={time:d3.time.scale,ordinal:d3.scale.ordinal,linear:d3.scale.linear},m=_.flatten(_.map(a,function(a){return a.values}));return{getXScale:j,getYScale:k}}],n=["svg","xscale","yscale","trigger","series","width","height",function(c,d,e,f,g,h){function i(i){function j(a){a.each(function(c){f("mouseoverStackbar",[c,b(a)])})}i.values.forEach(function(a){var b=0;a.scrutinized.forEach(function(a){a.y0=b,a.y1=b+=Math.max(0,a.value)}),a.total=a.scrutinized[a.scrutinized.length-1].y1});var k=c.selectAll("stacked-bar").data(i.values).enter().append("g").attr("transform",function(b){var c;return c="right"===g.stackedBarAlign?h-g.barWidth:d(b.datetime),a(c,0)}),l=k.selectAll("rect").data(function(a){return a.scrutinized}).enter().append("rect").attr("width",g.barWidth).attr("y",function(a){return e(a.y1)}).attr("height",function(a){return e(a.y0)-e(a.y1)}).style("cursor","pointer").style("fill",function(a){return a.color}).on("mousemove",function(a){f("mouseoverStackbar",[a,d3.mouse(this)])});setTimeout(function(){j(d3.select(_.last(l[0])))},0)}return{drawBar:i}}],o=["responsive","fullWidth","fullHeight","target","gmainTranslate",function(a,b,c,d,e){var f={};return f.draw=function(){return d3.select(d).append("svg").attr("width",a?"100%":b).attr("height",c).append("g").attr("class","g-main").attr("transform",e)},f}],i=["svg","trigger","height","width","xscale","margin",function(b,c,d,e,f,g){function h(){var a,b=f.domain();if(a=d3.event.sourceEvent?f.invert(d3.mouse(this)[0]):m.extent()[0],Date.parse(a)>Date.parse(b[1])&&(a=b[1]),Date.parse(a)<Date.parse(b[0])&&(a=b[0]),a.getMinutes()>=-30&&a.setHours(a.getHours()),a.setMinutes(0,0),Date.parse(j)!==Date.parse(a)){j=a;var d=Math.round(f(a))-1;i(d),c("moveTrail",[a])}}function i(a){l.attr("x1",a).attr("x2",a)}var j,k=b.append("g").attr("class","trail"),l=(b.append("svg:marker").attr("id","trailArrow").attr("class","trail-arrow").attr("viewBox","0 0 20 20").attr("refX","15").attr("refY","11").attr("markerUnits","strokeWidth").attr("markerWidth","15").attr("markerHeight","11").attr("orient","auto").append("svg:path").attr("d","M 0 0 L 20 10 L 0 20 z").attr("fill","#777"),k.append("svg:line").attr("class","trail-line").attr("x1",0).attr("x2",0).attr("y1",-g.top+10).attr("y2",d).attr("marker-start","url(#trailArrow)")),m=d3.svg.brush().x(f).extent([0,0]),n=b.append("g").attr("transform",a(0,0)).attr("class","trail-slider").call(m);n.select(".background").attr("height",d).attr("width",e).style("cursor","pointer"),b.selectAll(".extent,.resize").remove(),m.on("brush",h),setTimeout(function(){n.call(m.extent([new Date,new Date])).call(m.event)},0)}];"function"==typeof define&&define.amd?define(g):"object"==typeof module&&module.exports&&(module.exports=g),this.Charicharts=g}.call(window);